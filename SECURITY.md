# 🔐 安全认证系统说明

## 双重认证机制

为了提高文档的安全性，我们实现了一个双重认证系统，包含以下安全特性：

### 🔒 安全特性

1. **后端验证** - 访问码存储在服务端，前端无法直接获取
2. **双重认证** - 访问码 + 动态验证码
3. **设备指纹** - 基于浏览器特征生成唯一标识
4. **时效性验证** - 会话令牌和验证码都有有效期
5. **防暴力破解** - 验证失败后延迟响应
6. **基础防护** - 禁用开发者工具、右键菜单等

### 🚀 部署方式

#### 方式一：Vercel 部署（推荐）

1. **推送代码到 GitHub**
2. **连接 Vercel**：
   - 在 Vercel 中导入 GitHub 仓库
   - 自动检测为 VitePress 项目

3. **配置环境变量**：
   ```bash
   PRIMARY_ACCESS_CODE=xiaiyun2025
   DEV_ACCESS_CODE=dev-team-access-2025
   VIEWER_ACCESS_CODE=docs-viewer-2025
   JWT_SECRET=your-super-secret-jwt-key-here
   ```

4. **部署完成**：
   - 自动部署 VitePress 静态文件
   - API 路由自动生效

#### 方式二：Cloudflare Workers

如果使用 Cloudflare，需要将 API 函数改写为 Workers 格式：

```javascript
// workers/auth.js
export default {
  async fetch(request, env) {
    if (request.method !== 'POST') {
      return new Response('Method not allowed', { status: 405 });
    }
    
    const { accessCode, timestamp, fingerprint } = await request.json();
    
    // 验证逻辑...
    
    return new Response(JSON.stringify(result), {
      headers: { 'Content-Type': 'application/json' }
    });
  }
}
```

### 🔑 访问码管理

#### 当前访问码（示例）

⚠️ **部署前请务必修改这些访问码**

```
xiaiyun2025              # 主访问码
dev-team-access-2025     # 开发团队
docs-viewer-2025         # 文档查看者
```

#### 修改访问码

1. **服务端修改**：
   - 在 Vercel Dashboard 中更新环境变量
   - 或在 `api/auth.js` 中修改 `VALID_ACCESS_CODES`

2. **生效时间**：
   - 修改后需要重新部署才能生效
   - 现有用户的令牌在过期前仍然有效

### 🔒 验证码机制

验证码基于时间生成，特点：

- **6位数字** - 容易输入和记忆
- **5分钟有效期** - 平衡安全性和可用性  
- **容错机制** - 前一个周期的验证码也有效
- **确定性算法** - 相同时间戳生成相同验证码

### 👤 设备指纹

基于以下信息生成设备唯一标识：

- Canvas 渲染指纹
- 屏幕分辨率
- 时区信息
- 浏览器语言

### ⏰ 会话管理

- **访问令牌** - 24小时有效期
- **自动续期** - 刷新页面时检查有效性
- **安全清理** - 过期令牌自动清除

### 🛡️ 安全建议

#### 部署安全

1. **使用 HTTPS** - 确保数据传输加密
2. **强密钥** - JWT_SECRET 使用强随机密钥
3. **环境变量** - 敏感信息存储在环境变量中
4. **定期更新** - 定期更换访问码和密钥

#### 使用安全

1. **访问码保密** - 不要在公共场所泄露
2. **及时登出** - 公共设备使用后清除浏览器数据
3. **定期更换** - 建议每季度更换访问码
4. **监控访问** - 关注异常访问行为

### 🚨 应急处理

#### 发现未授权访问

1. **立即更换访问码**
2. **检查访问日志**
3. **通知团队成员**
4. **评估信息泄露风险**

#### 系统故障

1. **回退到简单认证** - 临时使用 `auth.html`
2. **检查 API 服务状态**
3. **查看错误日志**
4. **联系技术支持**

### 📊 本地开发

本地开发时系统会：

- **跳过网络认证** - 使用模拟 API 响应
- **简化验证** - 测试访问码 `test-code`
- **固定验证码** - 始终为 `123456`
- **自动通过** - 方便开发调试

测试步骤：
1. 启动本地服务：`npm run docs:dev`
2. 访问：`http://localhost:5173`
3. 输入测试访问码：`test-code`
4. 输入验证码：`123456`

### 📝 维护检查清单

#### 每月检查

- [ ] 检查访问码是否需要更新
- [ ] 验证 API 服务运行状态
- [ ] 查看访问统计数据
- [ ] 检查错误日志

#### 每季度检查

- [ ] 更换所有访问码
- [ ] 更新 JWT 密钥
- [ ] 审查用户访问权限
- [ ] 更新安全配置

#### 年度检查

- [ ] 全面安全审计
- [ ] 更新认证机制
- [ ] 培训团队成员
- [ ] 更新应急预案

---

## 📞 技术支持

如遇到认证系统问题，请联系：

- **开发团队**：提供技术支持
- **系统管理员**：处理访问权限
- **安全团队**：处理安全事件

**紧急联系方式**：请通过内部通讯渠道联系相关负责人